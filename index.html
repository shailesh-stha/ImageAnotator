<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-m-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Annotation Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gray-100 flex flex-col lg:flex-row h-screen overflow-hidden">

    <aside id="toolsPanel" class="w-full lg:w-80 bg-white p-6 space-y-4 overflow-y-auto controls-panel flex-shrink-0">
        <div class="flex justify-between items-center sidebar-header">
            <div class="space-y-1">
                <h1 class="text-2xl font-bold text-gray-800">Tools</h1>
                <p class="text-sm text-gray-500">Select and annotate areas.</p>
            </div>
            <button id="toolsToggleBtn" class="btn-toggle" title="Toggle Tools Panel">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z" clip-rule="evenodd" /></svg>
            </button>
        </div>
        <hr>
        <details class="control-section" open>
            <summary>Annotation Tools</summary>
            <div class="space-y-3 pt-3">
                <button id="addBoxBtn" class="btn btn-secondary w-full disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path d="M6.25 6.25a.75.75 0 000 1.5h7.5a.75.75 0 000-1.5h-7.5z" /><path fill-rule="evenodd" d="M2 5a3 3 0 013-3h10a3 3 0 013 3v10a3 3 0 01-3 3H5a3 3 0 01-3-3V5zm3-1.5A1.5 1.5 0 003.5 5v10A1.5 1.5 0 005 16.5h10A1.5 1.5 0 0016.5 15V5A1.5 1.5 0 0015 3.5H5z" clip-rule="evenodd" /></svg>
                    <span>Add Bbox</span>
                </button>
                <p class="text-xs text-gray-500 text-center">Shortcut: Press <kbd>B</kbd></p>
                <hr class="my-2">
                <button id="penToolBtn" class="btn btn-secondary w-full disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path d="M12.232 4.232a2.5 2.5 0 013.536 3.536l-1.225 1.224a.75.75 0 001.061 1.06l1.224-1.224a4 4 0 00-5.656-5.656l-3 3a4 4 0 00.225 5.865.75.75 0 00.977-1.138 2.5 2.5 0 01-.142-3.665l3-3z" /><path d="M8.603 14.997a4 4 0 005.656-5.656l-3-3a4 4 0 00-5.656 5.656l1.224 1.225a.75.75 0 001.061-1.06l-1.224-1.224a2.5 2.5 0 013.536-3.536l3 3a2.5 2.5 0 01-3.536 3.536l-1.225-1.224a.75.75 0 00-1.061 1.06l1.224 1.224z" /></svg>
                    <span>Pen Tool</span>
                </button>
                <p class="text-xs text-gray-500 text-center">Shortcut: Press <kbd>P</kbd></p>
                <hr class="my-2">
                <button id="addTextBtn" class="btn btn-secondary w-full disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path d="M10.125 1.75a.75.75 0 00-1.06 1.06L10 3.87V13.5a.75.75 0 001.5 0V3.87l.935-.936a.75.75 0 10-1.06-1.06L10.126 1.75zM3 6a.75.75 0 01.75.75v8.5c0 .69.56 1.25 1.25 1.25h10c.69 0 1.25-.56 1.25-1.25v-8.5a.75.75 0 011.5 0v8.5A2.75 2.75 0 0115 18H5a2.75 2.75 0 01-2.75-2.75v-8.5A.75.75 0 013 6z" /></svg>
                    <span>Add Text</span>
                </button>
                <p class="text-xs text-gray-500 text-center">Shortcut: Press <kbd>T</kbd></p>
            </div>
        </details>
        <details class="control-section" open>
            <summary>Selection Tool</summary>
            <div class="space-y-3 pt-3">
                <div>
                    <label for="aspectRatioSelect" class="block text-sm font-medium text-gray-600 mb-1">Aspect Ratio</label>
                    <select id="aspectRatioSelect" class="w-full p-2 border border-gray-300 rounded-md">
                        <option value="1:1">1:1 (Square)</option>
                        <option value="2:3">2:3 (Portrait)</option>
                        <option value="3:4">3:4 (Portrait)</option>
                        <option value="4:5">4:5 (Portrait)</option>
                        <option value="5:4">5:4 (Landscape)</option>
                        <option value="4:3">4:3 (Landscape)</option>
                        <option value="16:9">16:9 (Widescreen)</option>
                        <option value="9:16">9:16 (Tall)</option>
                        <option value="21:9">21:9 (Cinematic)</option>
                    </select>
                </div>
                <button id="drawSelectionBtn" class="btn btn-secondary w-full">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M2 5a3 3 0 013-3h10a3 3 0 013 3v10a3 3 0 01-3 3H5a3 3 0 01-3-3V5zm1.5.75c.414 0 .75.336.75.75v8.5a.75.75 0 01-1.5 0v-8.5c0-.414.336-.75.75-.75zM5.5 16a.75.75 0 000-1.5h9a.75.75 0 000 1.5h-9zM16.25 15a.75.75 0 00.75-.75v-8.5a.75.75 0 00-1.5 0v8.5c0 .414.336-.75.75-.75zM15 5.5a.75.75 0 01-1.5 0h-9a.75.75 0 010-1.5h9a.75.75 0 011.5 0z" clip-rule="evenodd" /></svg>
                    <span>Draw Selection</span>
                </button>
                <p class="text-xs text-gray-500 text-center">Shortcut: <kbd>Ctrl+D</kbd> to clear.</p>
            </div>
        </details>
    </aside>

    <main class="flex-1 flex items-center justify-center p-4 lg:p-8 overflow-hidden">
        <div id="canvasContainer" class="relative w-full h-full flex items-center justify-center">
             <canvas id="canvas"></canvas>
             <button id="unloadImageBtn" class="absolute z-10 p-1 bg-red-600 text-white rounded-full hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 hidden" style="transform: translate(50%, -50%);" title="Unload Image">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
            </button>
             <div id="placeholder" class="absolute text-center text-gray-500 pointer-events-none">
                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path vector-effect="non-scaling-stroke" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                <h3 class="mt-2 text-sm font-medium text-gray-900">Upload an Image</h3>
                <p class="mt-1 text-sm text-gray-500">Click or drag & drop a file.</p>
            </div>
            <div id="loadingIndicator" class="absolute text-center text-gray-500 pointer-events-none hidden">
                <svg class="animate-spin mx-auto h-12 w-12 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <h3 class="mt-2 text-sm font-medium text-gray-900">Loading Image...</h3>
            </div>
             <div id="canvasControls" class="absolute bottom-4 right-4 z-10 flex items-center space-x-2 bg-white bg-opacity-75 backdrop-blur-sm rounded-full p-1 shadow-md hidden">
                 <button id="zoomOutBtn" class="canvas-tool-btn relative bottom-0 right-0 p-2" title="Zoom Out (-)">
                     <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M4 10a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H4.75A.75.75 0 014 10z" clip-rule="evenodd" /></svg>
                 </button>
                 <button id="zoomInBtn" class="canvas-tool-btn relative bottom-0 right-0 p-2" title="Zoom In (+)">
                     <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" /></svg>
                 </button>
                 <span id="zoomLevelDisplay" class="text-sm font-medium text-gray-700 px-2 min-w-[50px] text-center">100%</span>
                 <button id="resetViewBtn" class="canvas-tool-btn relative bottom-0 right-0 p-2" title="Reset View (Zoom & Pan)">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M15.312 11.344A5.5 5.5 0 1111.5 6.656v1.094a.75.75 0 001.5 0v-2.5a.75.75 0 00-.75-.75h-2.5a.75.75 0 000 1.5h1.094a4 4 0 103.468 5.344z" clip-rule="evenodd" /></svg>
                 </button>
                 <button id="fitToScreenBtn" class="canvas-tool-btn relative bottom-0 right-0 p-2" title="Fit to Screen (F)">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path d="M6.5 3.5a.75.75 0 01.75-.75h6.5a.75.75 0 010 1.5h-5.5V9a.75.75 0 01-1.5 0V3.5zM12 15.25a.75.75 0 01.75.75v-5.5H17a.75.75 0 010 1.5h-4.25v4.25a.75.75 0 01-.75.75zM3.5 6.5A.75.75 0 014.25 7v5.5H9a.75.75 0 010 1.5H3.5a.75.75 0 01-.75-.75v-6.5zM15.25 8a.75.75 0 01.75-.75h-5.5V3a.75.75 0 011.5 0v4.25h4.25a.75.75 0 01.75.75z" /></svg>
                </button>
             </div>
        </div>
    </main>

    <aside id="propertiesPanel" class="w-full lg:w-80 bg-white p-6 space-y-4 overflow-y-auto controls-panel flex-shrink-0">
        <div class="flex justify-between items-center sidebar-header">
            <div class="space-y-1">
                <h1 class="text-2xl font-bold text-gray-800">Properties</h1>
                <p class="text-sm text-gray-500">Adjust annotations and styles.</p>
            </div>
            <button id="propertiesToggleBtn" class="btn-toggle" title="Toggle Properties Panel">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z" clip-rule="evenodd" /></svg>
            </button>
        </div>
        <hr>
        <details class="control-section" open>
            <summary>File & Actions</summary>
            <div class="space-y-2 pt-3">
                <input type="file" id="imageLoader" name="imageLoader" class="hidden" accept="image/*"/>
                <input type="file" id="jsonLoader" name="jsonLoader" class="hidden" accept=".json"/>
                <button id="uploadBtn" class="btn btn-secondary w-full">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M9.25 13.25a.75.75 0 001.5 0V4.636l2.955 3.129a.75.75 0 001.09-1.03l-4.25-4.5a.75.75 0 00-1.09 0l-4.25 4.5a.75.75 0 101.09 1.03L9.25 4.636v8.614z"></path><path d="M3.5 12.75a.75.75 0 00-1.5 0v2.5A2.75 2.75 0 004.75 18h10.5A2.75 2.75 0 0018 15.25v-2.5a.75.75 0 00-1.5 0v2.5c0 .69-.56 1.25-1.25 1.25H4.75c-.69 0-1.25-.56-1.25-1.25v-2.5z"></path></svg>
                    <span>Upload Image</span>
                </button>
                <button id="exportBtn" class="btn btn-primary w-full disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M10.75 2.75a.75.75 0 00-1.5 0v8.614L6.295 8.235a.75.75 0 10-1.09 1.03l4.25 4.5a.75.75 0 001.09 0l4.25-4.5a.75.75 0 00-1.09-1.03L10.75 11.364V2.75z"></path><path d="M3.5 12.75a.75.75 0 00-1.5 0v2.5A2.75 2.75 0 004.75 18h10.5A2.75 2.75 0 0018 15.25v-2.5a.75.75 0 00-1.5 0v2.5c0 .69-.56 1.25-1.25 1.25H4.75c-.69 0-1.25-.56-1.25-1.25v-2.5z"></path></svg>
                    <span>Export Image...</span>
                </button>
            </div>
        </details>
        <details class="control-section" open>
            <summary>Global Styles</summary>
            <div id="stylingControls" class="space-y-3 pt-3">
                <div>
                    <label for="colorPicker" class="block text-sm font-medium text-gray-600 mb-1">Color</label>
                    <div class="color-picker-wrapper"><input type="color" id="colorPicker" value="#FF0000"></div>
                </div>
                <div>
                    <label for="fontSize" class="block text-sm font-medium text-gray-600">Font Size (px)</label>
                    <div class="flex items-center space-x-2">
                        <button id="fontSizeDownBtn" class="btn-step">-</button>
                        <input type="text" id="fontSizeValueInput" class="value-input w-12 text-center" value="13">
                        <button id="fontSizeUpBtn" class="btn-step">+</button>
                        <input type="range" id="fontSize" min="8" max="48" value="13" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                    </div>
                </div>
                <div>
                    <label for="opacity" class="block text-sm font-medium text-gray-600">Opacity (%)</label>
                    <div class="flex items-center space-x-2">
                        <button id="opacityDownBtn" class="btn-step">-</button>
                        <input type="text" id="opacityValueInput" class="value-input w-12 text-center" value="100">
                        <button id="opacityUpBtn" class="btn-step">+</button>
                        <input type="range" id="opacity" min="0" max="100" value="100" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                    </div>
                </div>
                <button id="resetStylesBtn" class="btn btn-secondary w-full">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M15.312 11.344A5.5 5.5 0 1111.5 6.656v1.094a.75.75 0 001.5 0v-2.5a.75.75 0 00-.75-.75h-2.5a.75.75 0 000 1.5h1.094a4 4 0 103.468 5.344z" clip-rule="evenodd" /></svg>
                    <span>Reset Styles</span>
                </button>
            </div>
        </details>
        <details class="control-section" open>
            <summary>Edit</summary>
            <div class="space-y-2 pt-3">
                <div class="flex space-x-2">
                    <button id="undoBtn" class="btn btn-secondary w-full disabled:opacity-50" disabled>Undo</button>
                    <button id="redoBtn" class="btn btn-secondary w-full disabled:opacity-50" disabled>Redo</button>
                </div>
                <button id="deleteBtn" class="btn btn-danger w-full disabled:opacity-50" disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.75 1A2.75 2.75 0 006 3.75v.443c-.795.077-1.58.22-2.365.468a.75.75 0 10.23 1.482l.149-.022.841 10.518A2.75 2.75 0 007.596 19h4.807a2.75 2.75 0 002.742-2.53l.841-10.52.149.023a.75.75 0 00.23-1.482A41.03 41.03 0 0014 4.193v-.443A2.75 2.75 0 0011.25 1h-2.5zM10 4c.84 0 1.673.025 2.5.075V3.75c0 .69-.56-1.25-1.25-1.25h-2.5c-.69 0-1.25.56-1.25 1.25v.325C8.327 4.025 9.16 4 10 4zM8.58 7.72a.75.75 0 00-1.5.06l.3 7.5a.75.75 0 101.5-.06l-.3-7.5zm4.34.06a.75.75 0 10-1.5-.06l-.3 7.5a.75.75 0 101.5.06l.3-7.5z" clip-rule="evenodd"></path></svg>
                    <span>Delete Selected</span>
                </button>
            </div>
        </details>
        <details id="annotationListPanel" class="control-section" open>
            <summary>Annotations</summary>
            <div id="annotationList" class="space-y-2 pt-3 max-h-48 overflow-y-auto">
                <p id="annotationListPlaceholder" class="text-sm text-gray-500 italic">Upload an image to start.</p>
            </div>
        </details>
    </aside>

    <div id="toastContainer"></div>
    <div id="exportModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 class="text-xl font-bold mb-4">Export Options</h2>
            <p class="text-sm text-gray-600 mb-6">Choose how you want to export your annotated image.</p>
            <div class="space-y-3">
                <button id="copyToClipboardBtn" class="btn btn-primary w-full">
                    <span>Copy Image + Prompt for AI</span>
                    <small>Recommended for Gemini</small>
                </button>
                <button id="saveToFileBtn" class="btn btn-secondary w-full">
                    <span>Download Annotated Image</span>
                    <small>Saves a .png file</small>
                </button>
                <button id="saveJsonBtn" class="btn btn-secondary w-full">
                    <span>Download Annotations</span>
                    <small>Saves a .json file</small>
                </button>
            </div>
             <button id="closeModalBtn" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
        </div>
    </div>

     <div id="unloadConfirmModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 class="text-lg font-semibold mb-4">Unload Image?</h2>
            <p class="text-sm text-gray-600 mb-6">Are you sure you want to remove the current image and all its annotations?</p>
            <div class="flex justify-end space-x-3">
                <button id="cancelUnloadBtn" class="btn btn-secondary">No</button>
                <button id="confirmUnloadBtn" class="btn btn-danger">Yes</button> </div>
        </div>
    </div>

    <div id="helpModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 class="text-xl font-bold mb-4">Keyboard Shortcuts</h2>
            <div class="grid grid-cols-2 gap-4 text-sm">
                <div><kbd>B</kbd></div><div>Toggle Bounding Box Tool</div>
                <div><kbd>P</kbd></div><div>Toggle Pen Tool</div>
                <div><kbd>T</kbd></div><div>Toggle Text Tool</div>
                <div><kbd>Esc</kbd></div><div>Cancel Drawing / Close Modal</div>
                <div><kbd>Delete</kbd> / <kbd>Backspace</kbd></div><div>Delete Selected</div>
                <div><kbd>Ctrl</kbd> + <kbd>C</kbd></div><div>Copy Selected</div>
                <div><kbd>Ctrl</kbd> + <kbd>A</kbd></div><div>Select All</div>
                <div><kbd>Arrow Keys</kbd></div><div>Nudge Selected</div>
                <div><kbd>Shift</kbd> + <kbd>Arrow Keys</kbd></div><div>Nudge Selected (Large)</div>
                <div><kbd>Ctrl</kbd> + <kbd>Z</kbd></div><div>Undo</div>
                <div><kbd>Ctrl</kbd> + <kbd>Y</kbd></div><div>Redo</div>
                <div><kbd>+</kbd> / <kbd>=</kbd></div><div>Zoom In</div>
                <div><kbd>-</kbd></div><div>Zoom Out</div>
                <div><kbd>0</kbd></div><div>Reset Zoom</div>
                <div><kbd>F</kbd></div><div>Fit to Screen</div>
                <div><kbd>?</kbd></div><div>Show Help</div>
            </div>
            <button id="closeHelpModalBtn" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
        </div>
    </div>

    <script type="module" src="js/app.js"></script>
</body>
</html>